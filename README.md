# OpenWrt / iStoreOS Cloudflared ä¸€é”®å®‰è£…ç®¡ç†è„šæœ¬

[![GitHub](https://img.shields.io/github/license/hxzlplp7/openwrt-one-click-cloudflared)](LICENSE)

è¿™æ˜¯ä¸€ä¸ªé€‚ç”¨äº **OpenWrt** å’Œ **iStoreOS** è®¾å¤‡çš„ Cloudflare Tunnel (cloudflared) ä¸€é”®å®‰è£…ä¸ç®¡ç†è„šæœ¬ã€‚

## âš ï¸ é‡è¦è¯´æ˜

æœ¬è„šæœ¬ä½¿ç”¨ **Cloudflare è¿œç¨‹ç®¡ç†éš§é“ (Remotely-Managed Tunnel)** æ–¹å¼ï¼Œè¿™æ˜¯ Cloudflare æ¨èçš„æ–°æ–¹å¼ã€‚

**æ‚¨éœ€è¦å…ˆåœ¨ Cloudflare é¢æ¿åˆ›å»ºéš§é“ï¼Œè·å– Token åå†ä½¿ç”¨æœ¬è„šæœ¬ã€‚**

> ğŸ’¡ è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼šéš§é“é…ç½®ï¼ˆåŸŸåç»‘å®šã€è·¯ç”±è§„åˆ™ç­‰ï¼‰å…¨éƒ¨åœ¨ Cloudflare ç½‘é¡µé¢æ¿ç®¡ç†ï¼Œæ— éœ€åœ¨è·¯ç”±å™¨ä¸Šç¼–è¾‘é…ç½®æ–‡ä»¶ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸ”§ **è‡ªåŠ¨æ£€æµ‹æ¶æ„** - æ”¯æŒ amd64 (x86_64), arm64 (aarch64), arm (armv7) æ¶æ„
- ğŸ“¦ **ä¸€é”®å®‰è£…** - è‡ªåŠ¨ä¸‹è½½å®˜æ–¹äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å®‰è£…ä¾èµ–
- ğŸš€ **æœåŠ¡ç®¡ç†** - é€šè¿‡ OpenWrt æ ‡å‡†çš„ PROCD è¿›è¡Œç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢/é‡å¯/å¼€æœºè‡ªå¯ï¼‰
- ğŸ¯ **äº¤äº’å¼èœå•** - ç®€å•æ˜“ç”¨çš„ä¸­æ–‡ç®¡ç†ç•Œé¢
- ğŸ“– **å†…ç½®æŒ‡å—** - è¯¦ç»†çš„ Token è·å–è¯´æ˜
- âŒ¨ï¸ **å‘½ä»¤è¡Œæ”¯æŒ** - æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ç›´æ¥æ“ä½œ
- ğŸ“‹ **æ—¥å¿—æŸ¥çœ‹** - æ–¹ä¾¿æŸ¥çœ‹è¿è¡Œæ—¥å¿—æ’æŸ¥é—®é¢˜

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- OpenWrt 18.06+ æˆ– iStoreOS
- è‡³å°‘ 50MB å¯ç”¨å­˜å‚¨ç©ºé—´
- å¯è®¿é—® GitHub çš„ç½‘ç»œè¿æ¥ï¼ˆç”¨äºä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰
- Root æƒé™

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šåœ¨ Cloudflare åˆ›å»ºéš§é“è·å– Token

1. æ‰“å¼€ [Cloudflare Zero Trust é¢æ¿](https://one.dash.cloudflare.com/)
2. ç™»å½•æ‚¨çš„ Cloudflare è´¦æˆ·
3. åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **Networks** â†’ **Tunnels**
4. ç‚¹å‡» **Create a tunnel** (åˆ›å»ºéš§é“)
5. é€‰æ‹© **Cloudflared** ä½œä¸ºè¿æ¥å™¨ç±»å‹
6. ç»™éš§é“èµ·ä¸€ä¸ªåå­— (ä¾‹å¦‚: `openwrt-tunnel`)
7. åœ¨ "Install and run a connector" é¡µé¢ï¼Œæ‰¾åˆ°ç±»ä¼¼è¿™æ ·çš„å‘½ä»¤ï¼š
   ```
   cloudflared tunnel run --token eyJhIjoixxxxx...
   ```
8. å¤åˆ¶ `--token` åé¢çš„é‚£ä¸€é•¿ä¸²å­—ç¬¦ï¼ˆä»¥ `eyJ` å¼€å¤´çš„ Base64 ç¼–ç å­—ç¬¦ä¸²ï¼‰

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œå®‰è£…è„šæœ¬

ä½¿ç”¨ SSH è¿æ¥åˆ°ä½ çš„è·¯ç”±å™¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
wget -O /tmp/cloudflared.sh https://raw.githubusercontent.com/hxzlplp7/openwrt-one-click-cloudflared/main/cloudflared_install.sh && chmod +x /tmp/cloudflared.sh && sh /tmp/cloudflared.sh
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®å¹¶å¯åŠ¨

1. åœ¨èœå•ä¸­é€‰æ‹© **1. å®‰è£… Cloudflared**
2. å®‰è£…å®Œæˆåï¼Œé€‰æ‹© **2. é…ç½® Token**
3. ç²˜è´´ç¬¬ä¸€æ­¥è·å–çš„ Token
4. é€‰æ‹© **4. å¯åŠ¨æœåŠ¡**
5. å›åˆ° Cloudflare é¢æ¿é…ç½® **Public Hostname** ä»¥æš´éœ²æ‚¨çš„æœåŠ¡

### å¿«æ·å‘½ä»¤

å®‰è£…æˆåŠŸåï¼Œå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤å”¤èµ·ç®¡ç†èœå•ï¼š

```bash
cloudflared-menu
```

## ğŸ“– ä½¿ç”¨æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare Zero Trust é¢æ¿                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åˆ›å»º Tunnel â”‚ -> â”‚  è·å– Token â”‚ -> â”‚ é…ç½® Public Hostâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼ Token
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     OpenWrt / iStoreOS                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å®‰è£…è„šæœ¬    â”‚ -> â”‚ é…ç½® Token  â”‚ -> â”‚ å¯åŠ¨æœåŠ¡        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“– å‘½ä»¤è¡Œç”¨æ³•

è„šæœ¬æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ï¼Œæ–¹ä¾¿è‡ªåŠ¨åŒ–æ“ä½œï¼š

```bash
# å®‰è£…
cloudflared-menu install

# é…ç½® Token
cloudflared-menu token

# æ˜¾ç¤ºè·å– Token çš„æŒ‡å—
cloudflared-menu guide

# å¯åŠ¨æœåŠ¡
cloudflared-menu start

# åœæ­¢æœåŠ¡
cloudflared-menu stop

# é‡å¯æœåŠ¡
cloudflared-menu restart

# æŸ¥çœ‹çŠ¶æ€
cloudflared-menu status

# æŸ¥çœ‹æ—¥å¿—
cloudflared-menu logs

# å¸è½½
cloudflared-menu uninstall

# æ˜¾ç¤ºå¸®åŠ©
cloudflared-menu help
```

## ğŸ“ æ–‡ä»¶è·¯å¾„

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| äºŒè¿›åˆ¶æ–‡ä»¶ | `/usr/bin/cloudflared` |
| é…ç½®ç›®å½• | `/etc/cloudflared/` |
| Token æ–‡ä»¶ | `/etc/cloudflared/token` |
| å¯åŠ¨è„šæœ¬ | `/etc/init.d/cloudflared` |
| å¿«æ·å‘½ä»¤ | `/usr/bin/cloudflared-menu` |

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆéœ€è¦ Tokenï¼Ÿä¸èƒ½ç›´æ¥ç™»å½•å—ï¼Ÿ

A: Cloudflare Tunnel æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š
1. **æœ¬åœ°ç®¡ç†éš§é“** - éœ€è¦è¿è¡Œ `cloudflared tunnel login` åœ¨æµè§ˆå™¨ä¸­ç™»å½•
2. **è¿œç¨‹ç®¡ç†éš§é“ (æœ¬è„šæœ¬ä½¿ç”¨)** - åœ¨ Cloudflare é¢æ¿åˆ›å»ºéš§é“åè·å– Token

ç”±äº OpenWrt è·¯ç”±å™¨é€šå¸¸æ²¡æœ‰å›¾å½¢ç•Œé¢ï¼Œæ— æ³•æ–¹ä¾¿åœ°è¿›è¡Œæµè§ˆå™¨ç™»å½•ï¼Œå› æ­¤æœ¬è„šæœ¬é‡‡ç”¨ Token æ–¹å¼ã€‚è¿™ä¹Ÿæ˜¯ Cloudflare æ¨èçš„æ–¹å¼ï¼Œå› ä¸ºæ‰€æœ‰é…ç½®éƒ½å¯ä»¥åœ¨ç½‘é¡µé¢æ¿ä¸­ç®¡ç†ã€‚

### Q: Token æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

A: Token æ˜¯ä¸€ä¸ªä»¥ `eyJ` å¼€å¤´çš„é•¿å­—ç¬¦ä¸²ï¼ˆBase64 ç¼–ç çš„ JSONï¼‰ï¼Œä¾‹å¦‚ï¼š
```
eyJhIjoiYWJjMTIzNDU2Nzg5MGRlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IiwidCI6ImFiYzEyMzQ1Njc4OTBlZGVmZ2hpamtsbW5vcHFyc3R1dnd4IiwicyI6ImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MCJ9
```

### Q: å¦‚ä½•æš´éœ²æˆ‘çš„æœåŠ¡ï¼Ÿ

A: åœ¨ Cloudflare Zero Trust é¢æ¿ä¸­ï¼š
1. è¿›å…¥ **Networks** â†’ **Tunnels**
2. ç‚¹å‡»æ‚¨åˆ›å»ºçš„éš§é“
3. åˆ‡æ¢åˆ° **Public Hostname** æ ‡ç­¾
4. ç‚¹å‡» **Add a public hostname**
5. é…ç½®åŸŸåå’Œåç«¯æœåŠ¡åœ°å€ï¼ˆä¾‹å¦‚ `http://192.168.1.1:80`ï¼‰

### Q: ä¸‹è½½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: å¦‚æœæ— æ³•è¿æ¥ GitHubï¼Œå¯ä»¥ï¼š
- ä½¿ç”¨ä»£ç†/VPN
- æ‰‹åŠ¨ä¸‹è½½å¯¹åº”æ¶æ„çš„ cloudflared äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸Šä¼ åˆ° `/usr/bin/cloudflared`

ä¸‹è½½åœ°å€ï¼šhttps://github.com/cloudflare/cloudflared/releases/latest

## âš ï¸ æ³¨æ„äº‹é¡¹

- **ç½‘ç»œé—®é¢˜**: è„šæœ¬é»˜è®¤ä» GitHub å®˜æ–¹ Releases ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
- **å†…å­˜å ç”¨**: Cloudflared è¿è¡Œæ—¶å†…å­˜å ç”¨åœ¨ 30-100MB å·¦å³
- **å­˜å‚¨ç©ºé—´**: cloudflared äºŒè¿›åˆ¶æ–‡ä»¶çº¦ 40MB

## ğŸ› é—®é¢˜æ’æŸ¥

å¦‚æœæœåŠ¡æ— æ³•å¯åŠ¨ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# é€šè¿‡è„šæœ¬æŸ¥çœ‹
cloudflared-menu logs

# æˆ–ç›´æ¥ä½¿ç”¨ logread
logread | grep cloudflared
```

## ğŸ“œ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Cloudflare](https://www.cloudflare.com/) - æä¾›å…è´¹çš„ Tunnel æœåŠ¡
- [OpenWrt](https://openwrt.org/) - å¼€æºè·¯ç”±å™¨å›ºä»¶
